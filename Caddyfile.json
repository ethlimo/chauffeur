{
  "logging": {
    "logs": {
      "default": {
        "writer": {
          "output": "stdout"
        },
        "encoder": {
          "fields": {
            "request\u003eremote_ip": {
              "filter": "delete"
            },
            "request\u003eheaders\u003eX-Forwarded-For": {
              "filter": "delete"
            }
          },
          "format": "filter",
          "wrap": {
            "format": "json"
          }
        },
        "level": "DEBUG",
        "exclude": [
          "http.log.access.log0"
        ]
      },
      "log0": {
        "writer": {
          "output": "stdout"
        },
        "encoder": {
          "fields": {
            "request\u003eremote_ip": {
              "filter": "delete"
            },
            "request\u003eheaders\u003eX-Forwarded-For": {
              "filter": "delete"
            }
          },
          "format": "filter",
          "wrap": {
            "format": "json"
          }
        },
        "include": [
          "http.log.access.log0"
        ]
      }
    }
  },
  "apps": {
    "http": {
      "servers": {
        "srv0": {
          "listen": [
            ":443"
          ],
          "routes": [
            {
              "handle": [
                {
                  "handler": "encode",
                  "encodings": {
                    "gzip": {},
                    "zstd": {}
                  },
                  "prefer": [
                    "zstd",
                    "gzip"
                  ]
                },
                {
                  "handler": "subroute",
                  "routes": [
                    {
                      "handle": [
                        {
                          "handler": "reverse_proxy",
                          "transport": {
                            "protocol": "http"
                          },
                          "headers": {
                            "request": {
                              "delete": [
                                "X-Forwarded-For",
                                "Referer",
                                "User-Agent",
                                "X-Forwarded-Host"
                              ]
                            }
                          },
                          "upstreams": [
                            {
                              "dial": "limo-proxy:8888"
                            }
                          ],
                          "handle_response": [{
                            "match": {
                              "status_code": [305],
                              "headers": {
                                "X-Content-Codec": ["ipfs-ns", "ipns-ns"]
                              }
                            },
                            "routes": [
                              {
                                "handle": [
                                    {
                                        "handler": "rewrite",
                                        "uri": "{http.reverse_proxy.header.X-Content-Location}{http.request.uri.path}",
                                        "uri_substring": [
                                            {
                                                "find": "///",
                                                "replace": "/"
                                            },
                                            {
                                                "find": "//",
                                                "replace": "/"
                                            }
                                        ]
                                    },
                                    {
                                        "handler": "reverse_proxy",
                                        "upstreams": [
                                            {
                                                "dial": "ipfs:8080"
                                            }
                                        ]
                                    }
                                ]
                              }
                            ]
                          }]
                        }
                      ]
                    }
                  ]
                }
              ],
              "terminal": true
            }
          ]
        }
      }
    },
    "tls": {
      "automation": {
        "on_demand": {
          "rate_limit": {
            "interval": "10s",
            "burst": 100
          }
        },
        "policies": [
          {
            "on_demand": true,
            "issuers": [
              {
                "module": "internal"
              }
            ]
          }
        ]
      }
    }
  },
  "storage": {
    "module": "redis",
    "address": "redis:6379"
  }
}

